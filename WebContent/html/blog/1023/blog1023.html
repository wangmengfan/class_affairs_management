<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link href="/img/favicon.ico" type="image/x-icon" rel="shortcut icon" /> 
<title></title>
<style type="text/css">
#static_introduce table{width:520px !important;}
#static_introduce{word-wrap:break-word;word-break:break-all;}
</style>
</head>
<body>
<div id="static_introduce">1、基于官方mongo-java-driver.2.9.1,在项目中pom依赖Xml代码&lt;dependency&gt;&lt;groupId&gt;org.mongodb&lt;/groupId&gt;&lt;artifactId&gt;mongo-java-driver&lt;/artifactId&gt;&lt;version&gt;2.9.1&lt;/version&gt;&lt;/dependency&gt;2、mongodb启动在win7-32中Java代码mongod.exe--helpmongod.exe--dbpathD:\mongodb\data\db--auth-logpathD:\mongodb\log.log这里指定了数据库位置，--auth设置权限，这样访问mongo的所有数据库就需要授权才能访问。下面对数据库(sample)设置用户权限，在mongodb的shell中：Java代码1、mongo.exe2、usesample;3、showcollections;system.indexessystem.usersuser4、db.addUser(&#39;sa&#39;,&#39;sa&#39;)5、showcollections;FriOct2611:33:53uncaughtexception:error:{&quot;$err&quot;:&quot;unauthorizeddb:samplelocktype:-1client:127.0.0.1&quot;,&quot;code&quot;:10057}6、db.auth(&#39;sa&#39;,&#39;sa&#39;)7、showcollections;system.indexessystem.usersuser3、几个基本概念这里借鉴熟知的jdbc链接的步骤，我们可以用如下的步骤来：Java代码//1、建立连接Mongomongo=newMongo(&quot;127.0.0.1&quot;,27017);//2、获取文档(数据库),这里为sampleDBdb=mongo.getDB(&quot;sample&quot;);//3、验证用户if(db.authenticate(&quot;sa&quot;,&quot;sa&quot;.toCharArray())){//4、获取连接，这里是对集合user的操作DBCollectioncollection=db.getCollection(&quot;user&quot;);//对集合(表)进行各种操作(增删改查)DBObjectobj=collection.findOne()}以上的过程就类似我们建立一个jdbc的链接，其中与DriverManager、Connection、Statement 、ResultSet等很类似。对在第二部中的安全设置是在shell中完成的，这里在DB中同样提供了对数据库操作的API：Java代码DBdb=mongo.getDB(&quot;sample&quot;);db.addUser(&quot;sa&quot;,&quot;sa&quot;.toCharArray());4、基本操作对集合的操作主要是在DBCollection中，提供了一系列增删改查抽象或方法。下面来依次来看看这些方法的使用。4、1插入这里主要采用insert的几种多态接口，提供了对单个或批量的支持，同时也支持插入策略限定(WriteConcern)其中DBObject是一个key-value的map对应保存数据库的数据WriteConcern是控制写入策略，主要有三个方面的参数Java代码publicWriteConcern(intw,intwtimeout,booleanfsync){this(w,wtimeout,fsync,false);}w-1=don&#39;tevenreportnetworkerrors0=default,don&#39;tcallgetLastErrorbydefault1=basic,callgetLastError,butdon&#39;twaitforslaves2+=waitforslaveswtimeouthowlongtowaitforslavesbeforefailing0=indefinite&gt;0=mstowaitfsyncforcefsynctodisk我们以插入以下内容为例：Java代码{&quot;name&quot;:&quot;mongo&quot;,&quot;type&quot;:&quot;db&quot;,&quot;info&quot;:{&quot;comp&quot;:&quot;10gen&quot;,&quot;driver&quot;:&quot;java&quot;}}采用BasicDBObject封装插入数据，继承自DBObject，支持多种数据格式Java代码//用BasicDBObject作为插入的封装数据BasicDBObjectuser=newBasicDBObject();user.put(&quot;name&quot;,&quot;mongo&quot;);user.put(&quot;type&quot;,&quot;DB&quot;);//这里是子对象BasicDBObjectinfo=newBasicDBObject();info.put(&quot;comp&quot;,&quot;10gen&quot;);info.put(&quot;driver&quot;,&quot;java&quot;);user.put(&quot;info&quot;,info);collection.insert(user);采用BasicDBObjectBuilderJava代码BasicDBObjectBuilderbuilder=BasicDBObjectBuilder.start().add(&quot;name&quot;,&quot;mongo&quot;).add(&quot;type&quot;,&quot;DB&quot;);BasicDBObjectBuilderinfo=BasicDBObjectBuilder.start().add(&quot;comp&quot;,&quot;10gen&quot;).add(&quot;driver&quot;,&quot;java&quot;);builder.add(&quot;info&quot;,info.get());collection.insert(builder.get());同样也支持Map，用法与上面的一致。对批量的支持也一样，传入List或DBObeject数组即可，如：Java代码WriteResultresult=collection.insert(list,WriteConcern.SAFE);这里是否返回插入错误信息依赖插入的策略WriteConcern.SAFE4、2查找更新一系列方法与插入类似，接受DBObject根据查询条件返回DBObject(单个)或DBCursor(多个)下面是一些常用的api：Java代码//查找一个，当然返回任意一个没多大实际意义DBObjectobj=collection.findOne();Java代码//查找一个：name=mongoDBObjectobj=collection.findOne(newBasicDBObject(&quot;name&quot;,&quot;mongo&quot;));Java代码//查找多个：满足name=mongo的所有结果集DBCursorcursor=collection.find(newBasicDBObject(&quot;name&quot;,&quot;mongo&quot;));Java代码//查找多个：满足age在(30,40]的所有结果集:&quot;$gt&quot;：大于&quot;$gte&quot;：大于等于&quot;$lt&quot;：小于&quot;$lte&quot;：小于等于DBCursorcursor=collection.find(newBasicDBObject(&quot;age&quot;,newBasicDBObject(&quot;$gt&quot;,30).append(&quot;$lte&quot;,40)));Java代码//查询分页DBCursorcursor=collection.find(newBasicDBObject(&quot;age&quot;,newBasicDBObject(&quot;$gt&quot;,30).append(&quot;$lte&quot;,60))).skip(0).limit(5);Java代码//模糊匹配：usernamelikerobin(正则匹配)DBCursorcursor=collection.find(newBasicDBObject(&quot;username&quot;,Pattern.compile(&quot;robin&quot;)));//根据子文档查询:DBCursorcursor=collection.find(newBasicDBObject(&quot;info.comp&quot;,&quot;10gen&quot;));Java代码//返回指定的列DBCursorcursor=collection.find(newBasicDBObject(&quot;name&quot;,&quot;mongo&quot;),newBasicDBObject(&quot;name&quot;,1).append(&quot;type&quot;,1));以上DBCursor是数据库结果集的迭代，我们可以通过Java代码DBCursorcursor=collection.find(query);if(cursor.hasNext())DBObjectobj=cursor.next();来获取数据。同时DBCursor还提供了对查询的限定，如前面说到的skip()、limit()等，还介绍几个常用的方法：Java代码1、publicDBCursorsort(DBObjectorderBy)//与orderby类似2、publicDBCursorhint(DBObjectindexKeys)//强制使用索引3、publicDBObjectexplain()//explain不解释4、publicDBCursorbatchSize(intn)//限制一次返回数据5、publicintcount()//返回匹配的数量，不受limit/skip影响6、publicintsize()//返回当前查询返回数量，受limit/skip影响</div>

</body>

</html>